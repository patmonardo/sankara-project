Testing Relation Definition & Shape Repository operations...
Initializing connection...
Connected to Neo4j successfully
‚úÖ Connected to Neo4j

üßπ CLEANING UP PREVIOUS TEST DATA (if any)...
‚úÖ Cleanup complete.

==== RELATION DEFINITION OPERATIONS ====

üìù CREATING RELATION DEFINITION:
Definition to save: {
  "id": "9e111423-44f6-408b-aa2f-5c5d61b6e8e7",
  "name": "Tests Relation",
  "description": "A test relation definition",
  "type": "TEST_RELATION",
  "createdAt": 1746061343966,
  "cardinality": "many-to-many",
  "inverse": {
    "type": "REFERENCED_BY",
    "name": "Referenced By"
  },
  "constraints": [
    {
      "id": "constraint1",
      "name": "UniqueConstraint",
      "type": "sourceType",
      "value": "Person",
      "message": "Source must be a Person"
    },
    {
      "id": "constraint2",
      "name": "UniqueConstraint",
      "type": "targetType",
      "value": "Document",
      "message": "Target must be a Document"
    }
  ],
  "tags": [
    "test",
    "example"
  ],
  "behaviors": [
    {
      "id": "behavior1",
      "name": "LogAccess",
      "event": "onRead",
      "handler": "function log(rel) { console.log(\"Accessed:\", rel.id); }",
      "active": true
    }
  ]
}
Error getting relation definition from Neo4j: Neo4jError: Variable `constraintData` not defined (line 6, column 17 (offset: 144))
"        WITH r, constraintData, collect(DISTINCT t.name) as tags // Collect distinct tag names"
                 ^
Error saving relation definition to Neo4j: Neo4jError: Variable `constraintData` not defined (line 6, column 17 (offset: 144))
"        WITH r, constraintData, collect(DISTINCT t.name) as tags // Collect distinct tag names"
                 ^

‚ùå ERROR DURING RELATION REPOSITORY TEST: Neo4jError: Variable `constraintData` not defined (line 6, column 17 (offset: 144))
"        WITH r, constraintData, collect(DISTINCT t.name) as tags // Collect distinct tag names"
                 ^

    at captureStacktrace (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-core@5.28.1/node_modules/neo4j-driver-core/lib/result.js:624:17)
    at new Result (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-core@5.28.1/node_modules/neo4j-driver-core/lib/result.js:112:23)
    at Session._run (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-core@5.28.1/node_modules/neo4j-driver-core/lib/session.js:224:16)
    at Session.run (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-core@5.28.1/node_modules/neo4j-driver-core/lib/session.js:188:27)
    at RelationDefinitionRepository.getRelationDefinitionById (/home/pat/VSCode/sankara/app/neo/extension/neo4j/repository/relation.def.ts:241:36)
    at RelationDefinitionRepository.saveRelationDefinition (/home/pat/VSCode/sankara/app/neo/extension/neo4j/repository/relation.def.ts:85:35)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async testRelationRepositories (/home/pat/VSCode/sankara/app/neo/extension/neo4j/repository/relation.cmd.ts:124:29) {
  constructor: [Function: Neo4jError] { isRetriable: [Function (anonymous)] },
  gqlStatus: '42001',
  gqlStatusDescription: 'error: syntax error or access rule violation - invalid syntax',
  diagnosticRecord: {
    OPERATION: '',
    OPERATION_CODE: '0',
    CURRENT_SCHEMA: '/',
    _classification: 'CLIENT_ERROR',
    _position: { column: 17, line: 6, offset: 144 }
  },
  classification: 'CLIENT_ERROR',
  rawClassification: 'CLIENT_ERROR',
  code: 'Neo.ClientError.Statement.SyntaxError',
  retriable: false,
  [cause]: GQLError: 42N62: Variable `constraintData` not defined.
      at new GQLError (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-core@5.28.1/node_modules/neo4j-driver-core/lib/error.js:117:24)
      at newGQLError (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-core@5.28.1/node_modules/neo4j-driver-core/lib/error.js:261:12)
      at ResponseHandler._handleErrorCause (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-bolt-connection@5.28.1/node_modules/neo4j-driver-bolt-connection/lib/bolt/response-handler.js:199:57)
      at ResponseHandler._handleErrorPayload (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-bolt-connection@5.28.1/node_modules/neo4j-driver-bolt-connection/lib/bolt/response-handler.js:193:50)
      at ResponseHandler.handleResponse (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-bolt-connection@5.28.1/node_modules/neo4j-driver-bolt-connection/lib/bolt/response-handler.js:116:49)
      at dechunker.onmessage (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-bolt-connection@5.28.1/node_modules/neo4j-driver-bolt-connection/lib/bolt/create.js:74:33)
      at Dechunker._onHeader (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-bolt-connection@5.28.1/node_modules/neo4j-driver-bolt-connection/lib/channel/chunking.js:196:18)
      at Dechunker.AWAITING_CHUNK (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-bolt-connection@5.28.1/node_modules/neo4j-driver-bolt-connection/lib/channel/chunking.js:149:25)
      at Dechunker.write (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-bolt-connection@5.28.1/node_modules/neo4j-driver-bolt-connection/lib/channel/chunking.js:206:32)
      at channel.onmessage (/home/pat/VSCode/sankara/node_modules/.pnpm/neo4j-driver-bolt-connection@5.28.1/node_modules/neo4j-driver-bolt-connection/lib/bolt/create.js:70:63) {
    constructor: [Function: GQLError],
    cause: undefined,
    gqlStatus: '42N62',
    gqlStatusDescription: 'error: syntax error or access rule violation - variable not defined. Variable `constraintData` not defined.',
    diagnosticRecord: {
      OPERATION: '',
      OPERATION_CODE: '0',
      CURRENT_SCHEMA: '/',
      _classification: 'CLIENT_ERROR',
      _position: [Object]
    },
    classification: 'CLIENT_ERROR',
    rawClassification: 'CLIENT_ERROR'
  }
}

Closing connection...
‚úÖ Connection closed.
